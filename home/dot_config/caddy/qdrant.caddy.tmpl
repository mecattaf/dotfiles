{{- $service := .infrastructure.services.qdrant }}
{{- if and (eq .openwebui.providers.vector_db "qdrant") $service.external_subdomain }}

# ─────────────────────────────────────────────────────────────────────────────
# {{ $service.description }}
# Dashboard: https://{{ $service.external_subdomain }}.{{ .tailscale.full_hostname }}
# ─────────────────────────────────────────────────────────────────────────────

https://{{ $service.external_subdomain }}.{{ .tailscale.full_hostname }} {
    reverse_proxy {{ $service.bind | default "127.0.0.1" }}:{{ $service.published_port | default $service.port }} {
        # Standard proxy headers
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-Host {host}
    }
    
    # Logging
    log {
        output file /var/log/caddy/qdrant.log {
            roll_size 50mb
            roll_keep 3
        }
        format console
        level ERROR
    }
}

{{- end }}
