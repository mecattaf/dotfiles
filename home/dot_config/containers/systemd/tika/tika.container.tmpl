{{- if eq .openwebui.providers.content_extraction "tika" }}
# ═════════════════════════════════════════════════════════════════════════════
# 📄 APACHE TIKA - Content Extraction Service
# Generated by Chezmoi - DO NOT EDIT MANUALLY
# Conditionally enabled when: openwebui.providers.content_extraction == "tika"
# ═════════════════════════════════════════════════════════════════════════════

[Unit]
Description={{ .infrastructure.services.tika.description }}
After=network-online.target {{ .infrastructure.network.name }}.network.service
Requires={{ .infrastructure.network.name }}.network.service

[Container]
Image={{ .infrastructure.services.tika.image }}
AutoUpdate=registry
ContainerName={{ .infrastructure.services.tika.container_name }}

# ═════════════════════════════════════════════════════════════════════════════
# 🌐 NETWORK - Internal only, no published ports
# ═════════════════════════════════════════════════════════════════════════════
Network={{ .infrastructure.network.name }}.network

# ═════════════════════════════════════════════════════════════════════════════
# 🔐 ENVIRONMENT - Java heap settings for document processing
# ═════════════════════════════════════════════════════════════════════════════
Environment=TIKA_CHILD_JAVA_OPTS=-JXmx{{ .tika.heap_size | default "2g" }}
Environment=TIKA_CHILD_MAX_HEAP={{ .tika.heap_size | default "2g" }}

# ═════════════════════════════════════════════════════════════════════════════
# 🔧 HEALTH CHECK
# ═════════════════════════════════════════════════════════════════════════════
HealthCmd=wget --no-verbose --tries=1 --spider http://localhost:{{ .infrastructure.services.tika.port }}/tika || exit 1
HealthInterval=30s
HealthTimeout=5s
HealthRetries=3
HealthStartPeriod=30s

# ═════════════════════════════════════════════════════════════════════════════
# 🚀 SERVICE
# ═════════════════════════════════════════════════════════════════════════════
[Service]
Slice=llm.slice
TimeoutStartSec=600
Restart=on-failure
RestartSec=10

[Install]
# No WantedBy - dependencies via After/Requires
{{- end }}
